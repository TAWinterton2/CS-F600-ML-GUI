{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/multi_form_style.css') }}">
    <title>Multi-Form Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

{% endblock %}

{% block body %}
    <div class="main">
        <div class="steps">
            <div id="regForm" action="">
                <div style="text-align:left; margin-top:20px;">
                    <span class="step"></span>
                    <span class="step"></span>
                    <span class="step"></span>
                    <span class="step"></span>
                    <span class="step"></span>
                </div>

                <h1 class="ML">Linear Regression</h1>
                
                <!-- Div for Uploading Dataset-->
                <div class="tab" id="step_1"><h2>Step 1: Uploading Dataset</h2>
                    <p>To begin, we will start by uploading a dataset that our model will use.</p>
                    <p>You may use your own dataset, or use the one provided by the link below</p>
                    <p><a href="https://cdn.wsform.com/wp-content/uploads/2020/06/probability.csv">https://cdn.wsform.com/wp-content/uploads/2020/06/probability.csv.</a></p>
                    <p><strong>make sure that your dataset is stricly numerical data! and is in the <br> form
                        form of a .csv file!</strong></p>

                        {% if file_upload == True %}
                        <form id="columns" method="POST">
                            <p style="color:blue">File uploaded: {{filename}}.</p>
                            <p>Please select which columns you would like to test over.</p>

                            <label>Select X value
                            <select type="X" name="X">
                                {% for c in column_names %}
                                <option value="{{c}}">{{c}}</option>
                                {% endfor %}
                            </select></label>

                            <label>Select Y value
                            <select type="Y" name="Y">
                                {% for c in column_names %}
                                <option value="{{c}}">{{c}}</option>
                                {% endfor %}
                            </select></label>

                            <input type="submit" name="select_xy" value="Submit Column Selection">
                        </form>

                        {% else %}
                        <form id="upload" method="POST" enctype="multipart/form-data">
                            <input type="file" name="file">
                            <input type="submit" name="upload_file" value="Submit File">
                        </form>
                        {% endif %}
                        <p style="color:crimson">{{error}}</p>
                </div>

                <!-- Div for Scaling the Data Set-->
                <div class="tab" id="step_2"><h2>Step 2: Scaling the Dataset</h2>
                    <p>Now we will scale our data.</p>
                    <p>Scaling refers to putting our values in our dataset into the same range. There are two
                        ways we can scale our data.
                    </p>
                    <p><strong> Normalize:</strong> We map the minimum feature value to 0 and 
                    the maximum to 1, creating a [0, 1] range</p>
                    <p><strong>Standardized:</strong> We transform the data to have a mean of 0 and a standard deviation of 1</p>
                    <form id="scale_type" method="POST">
                        <select name="scale" id="scale">
                            <option value="Standardize">Standardize</option>
                            <option value="Normalize">Normalize</option>
                        </select>

                        <input type="submit" name="scaling" value="Scaling Selected">
                    </form>
                </div>

                <!-- Div for Setting Testing and Training Sets-->
                <div class="tab" id="step_3"><h2>Step 3: Training and Testing</h2>
                    <p>Now we will split our dataset into 2 different sets. A Training set and a Testing Set</p>
                    <p><strong>Training Set:</strong> This is the part of the data that will be used to train our model</p>
                    <p><strong>Testing Set:</strong> This is the part of data that we will use to test our model</p>
                    <p>What ratio which you set your 2 sets will affect the accuracy of your final ML model</p>
                    <p>To start, we reccommend using the provided default values, before entering your own</p>
                    {% if traintest == True %}
                        <p><b><u>User Supplied Inputs</u></b><br/>
                        <b>Training</b>: {{tr}}<br/>
                        <b>Testing</b>: {{te}}</p>
                        <p>If you would like to continue to the next step, press the 'Next' button. If you would like to change the split, simply
                            choose new test/train values and press the submit button.</p>
                    {% endif %}
                    <form id="trte" method="POST">
                        <label for="training">Training:
                        <input type="number" step="1" min="1" max="99" id="training" name="training" placeholder="80" value="80" oninput="this.className = ''"></label>
                        <label for="training">Testing:
                        <input type="number" step="1" min="1" max="99" id="testing" name="testing" placeholder="20" value="20"oninput="this.className = ''"></label>
                        <input type="submit" name="tt" value="Submit Training/Testing">
                    </form>
                    <p style="color:red">{{ error }}</p>
                </div>

                <div class="tab" id="step_4"><h2>Step 4: Initialize the Model</h2>
                    <p style="color:red">{{ hyper_error }}</p>
                    {% if hyper==True %}
                    <p>Hyperparameters successfully inputted. Please press the next button to run the model.</p>
                    {% else %}
                    <form id="init" method="POST">
                    <p>
                        In this page, you can adjust various aspects about how Machine Learning Model will behave. 
                        Hyperparameters are parameters of the model that cannot be directly learned from the data
                    </p>

                    <p> We reccommend you run your first model using the defaul Hyperparameters values. Afterwards
                        then you can experiment with each setting.
                    </p>

                    <p> For more details about each hyperparmeter, hover your mouse courser over the hyperparmeter name.</p>
                        
                        <label>Penalty:
                        <select name="penalty" id="Hyperparameters">
                            <option value="l2">l2</option>
                            <option value="l1">l1</option>
                            <option value="elasticent">Elasticent</option>
                            <option value="none">None</option>
                        </select></label>

                        <label for="l1_ratio">l1 Ratio: 
                            <input type="number" class="Hyperparameters" step="0.01" min="0" max = "1" name="l1_ratio" value="0.15" oninput="this.className =''">
                        </label>





                        <label>Loss Strength:
                        <select name = "loss_strength" id="Hyperparameters">
                            <option value="squared_error">Squared Error</option>
                            <option value="epsilon_insensitive">Epsilon Insensitive</option>
                            <option value="squared_epsilon_insensitive">Squared Epsilon Insensitive</option>
                            <option value="huber">Huber</option>
                        </select></label>

                        <label for="epsilon">Epsilon:   
                            <input type="number" step="0.1" min="0" class="Hyperparameters" name="epsilon" value="0.1" oninput="this.className=''">
                        </label>






                        <label>Shuffle: 
                            <select name="shuffle" class ="Hyperparameters">
                                <option value='True'>True</option>
                                <option value='False'>False</option>
                        </select></label>

                        <label for="rand_state">Random State:   
                            <input type="number" step="1" min="0" class="Hyperparameters" name="rand_state" value="0" oninput="this.className=''">
                        </label>




                        <label for="n_iter_no_change"> Number of Iterations (no change):
                            <input type="number" step="1" min="0" class="Hyperparameters" name="n_iter_no_change" value="5" oninput="this.className=''">
                        </label>

                        <label for ="tol">Tol:  
                            <input type="number" step="0.001" min="0" class="Hyperparameters" name="tol" value="0.001" oninput="this.className=''">
                        </label>

                        <label>Early Stopping:
                            <select name = "early_stopping" class="Hyperparameters">
                                <option value="True">True</option>
                                <option value="False">False</option>
                        </select></label>

                        <label for="validation_fraction">Validation Fraction:
                            <input type="number" step="0.1" min="0.1" max="1.0" class="Hyperparameters" name="validation_fraction" value="0.1" oninput="this.className=''">
                        </label>

                        <label for="eta0">eta0: 
                            <input type="number" step="0.01" min="0" class="Hyperparameters" name="eta0" value="0.01" oninput="this.className=''">
                        </label>

                        <label for="power_t">Power_T:   
                            <input type="number" step="0.01" min="0" class="Hyperparameters" name="power_t" value="0.25" oninput="this.className=''">
                        </label>

                        <label>Learning Rate:
                            <select name="learning_rate" class="Hyperparameters">
                                <option value="invscaling">Invscaling</option>
                                <option value="constant">Constant</option>
                                <option value="optimal">Optimal</option>
                                <option value="adaptive">Adaptive</option>
                        </select></label>

                        <label for="alpha">Alpha:   
                            <input type="number" class="Hyperparameters" step="0.0001" min="0"name="alpha" value="0.0001" oninput="this.className = ' '">
                        </label>

                        <label for="max_iter">Max Iteration:    
                            <input type="number" step="1" min="0" class="Hyperparameters" name="max_iter" value="1000" oninput="this.className = ''">
                        </label>

                        <label for="verbose">Verbose:   
                            <input type="number" step="1" min="0" class="Hyperparameters" name="verbose" value="0" oninput="this.className=''">
                        </label>

                        <label>Fit Intercept:   
                            <select name="fit_intercept" id = "fit_intercept">
                                <option value ='True'>True</option>
                                <option value ='False'>False</option>
                        </select></label>
    
                        <label>Warm Start:  
                        <select name ="warm_start" class = "Hyperparameters">
                            <option value="True">True</option>
                            <option value="False">False</option>
                        </select></label>

                        <label>Average: 
                        <select name="average" class ="Hyperparameters">
                            <option value="True">True</option>
                            <option value="False">False</option>
                        </select></label>
                    <br/>      
                    <input type="submit" name="hyperparams" value="Hyperparams">
                </form>
                {% endif %}
                </div>

                <!-- Div for Running the Model-->
                <div class="tab" id="step_5"><h2>Step 5: Run</h2>
                    <form id="run" method="POST">
                    <p> Please review and confirm all of your selected settings for your model. When you are ready, click the "Run the Model" button.</p>
                    <input type="submit" name="run" value="Run the model">
                </form>

                </div>
                <p>Once you are done with the above step and have submitted, click on the next button.</p>
                
                
                <!-- Next and Previous Buttons for Multi-page form-->
                <div style="overflow:auto;">
                    <div style="float:right;">
                    <button type="button" id="prevStp" onclick="nextPrev(-1)">Previous</button>
                    <button type="button" id="nextStp" onclick="nextPrev(1)">Next</button>
                    </div>
                </div>

            </div>
            <script type="text/javascript" id="js_tabs" tab_num = {{tab}} src="{{url_for('static', filename='ml_form_script.js')}}"></script>
        </div>

        <!-- Div for Output Display on Right Hand Side of Webpage-->
        <div class="display">
            <div class="output">
                <h1>Output</h1>
                {% if user_input == False %}
                    <p>Here will be any visualizations from the program.</p>
                {% else %}
                <form>
                    <input type="button" value="View Original Data" id="orig" og_df = '{{og_df}}' onclick="openWin()">
                </form>
                {% endif %}

                <!--If the flask server returns that a file has been uploaded, display a dummy graph.-->
                {% if columns_selected == True %}
                <h2>Original Dataset</h2>
                    <canvas id="myChart" style="width:80%; background-color: antiquewhite; align-content: center;"></canvas>
                    <script type="text/javascript" id="graph" name = "{{name}}" data = '{{data}}' columns = '{{column_names}}' src="{{url_for('static', filename='graph.js')}}"></script>
                {% endif %}

                <!--If the flask server returns that scaling has finished, display a table full of dummy data.-->
                {% if scaling==True %}
                <h2>Scaled Data</h2>
                    {% for table in tables %}
                        <table>
                            <tbody>
                                {{ table|safe }}
                            </tbody>
                        </table>
                    {% endfor %}
                {% endif %}

                <!--If the flask server returns that training/testing has finished, display 2 dummy graphs.-->
                {% if traintest==True %}
                <h2>Testing Dataset</h2>
                    <canvas id="test_chart" style="width:100%;max-width:300px;background-color: antiquewhite;align-content: center;"></canvas>
                    <script type="text/javascript" id="graph" name = "{{test_name}}" data = '{{test_data}}' columns = '{{column_names}}' src="{{url_for('static', filename='graph.js')}}"></script>
                <h2>Training Dataset</h2>
                    <canvas id="train_chart" style="width:100%;max-width:300px;background-color: antiquewhite;align-content: center;"></canvas>
                    <script type="text/javascript" id="train_graph" name = "{{training_name}}" data = '{{training_data}}' columns = '{{column_names}}' src="{{url_for('static', filename='train_graph.js')}}"></script>
                {% endif %}

                
                {% if start==True %}

                <h2>Evaluation Data</h2>
                    {% for table in tables %}
                        <table>
                            <tbody>
                                {{ table|safe }}
                            </tbody>
                        </table>
                    {% endfor %}
                <canvas id="eval" style="width:100%;max-width:300px;background-color: antiquewhite;align-content: center;"></canvas>
                <script type="text/javascript" id="pred_graph" name = "{{name}}" data = '{{data}}' pred = '{{pred}}' columns = '{{column_names}}' src="{{url_for('static', filename='prediction.js')}}"></script>
                    
                {% endif %}
            </div>
           
        </div>
        
    </div>
{% endblock %}
